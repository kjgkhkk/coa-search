<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Gunster Biotech — CoA Search & Download</title>
<script>
const API_KEY = 'AIzaSyCHe4kvj5Mgv9MTdS9rL5Dxrg8d2qrTkzI';
const FOLDER_ID = '1cstVGEu9aSqYnSMNJsbH_-2s1wtn-jsj'; // 「和我共用」或一般資料夾 ID // 「和我共用」或一般資料夾 ID
const DRIVE_ID = ''; // 如果是共享雲端硬碟資料夾，填 Drive ID，否則留空 // 如果是共享雲端硬碟資料夾，填 Drive ID，否則留空

async function searchFiles() {
  const q = document.getElementById('query').value.trim();
  if (!q) return;

  let url = new URL('https://www.googleapis.com/drive/v3/files');
  url.searchParams.set('q', `'${FOLDER_ID}' in parents and name contains '${q}'`);
  url.searchParams.set('key', API_KEY);
  url.searchParams.set('fields', 'files(id,name,webViewLink,webContentLink)');
  url.searchParams.set('pageSize', '100');
  url.searchParams.set('orderBy', 'modifiedTime desc');
  url.searchParams.set('supportsAllDrives', 'true');
  url.searchParams.set('includeItemsFromAllDrives', 'true');
  if (DRIVE_ID) {
    url.searchParams.set('corpora', 'drive');
    url.searchParams.set('driveId', DRIVE_ID);
  }

  document.getElementById('results').innerHTML = '<tr><td colspan="3">Searching...</td></tr>';

  try {
    const r = await fetch(url);
    if (!r.ok) throw new Error(`HTTP ${r.status}`);
    const data = await r.json();
    renderRows(data.files || []);
  } catch (e) {
    document.getElementById('results').innerHTML = `<tr><td colspan="3">Search failed: ${e.message}</td></tr>`;
  }
}

function renderRows(files) {
  const results = document.getElementById('results');
  results.innerHTML = '';
  if (files.length === 0) {
    results.innerHTML = '<tr><td colspan="3">No files found.</td></tr>';
    return;
  }
  files.forEach((f, i) => {
    results.innerHTML += `<tr><td>${i + 1}</td><td>${f.name}</td><td><a href="${f.webViewLink}" target="_blank">View</a> | <a href="${f.webContentLink}" target="_blank">Download</a></td></tr>`;
  });
}

function clearSearch() {
  document.getElementById('query').value = '';
  document.getElementById('results').innerHTML = '';
}
</script>
</head>
<body>
<h1>Gunster Biotech — CoA Search & Download</h1>
<input id="query" type="text" placeholder="Type a LOT or filename keyword">
<button onclick="searchFiles()">Search</button>
<button onclick="clearSearch()">Clear</button>
<table border="1"><tbody id="results"></tbody></table>
</body>
</html>
