<!DOCTYPE html>
<html>
<head>
    <title>Gunster Biotech — CoA Search & Download (Simple)</title>
</head>
<body>
    <h1>Gunster Biotech — CoA Search & Download (Simple)</h1>
    <input type="text" id="searchInput" placeholder="Enter keyword">
    <button onclick="searchFiles()">Search</button>
    <button onclick="clearResults()">Clear</button>
    <table border="1" id="resultsTable">
        <tr><th>#</th><th>Filename</th><th>Action</th></tr>
    </table>
    <script>
        const API_KEY = 'AIzaSyCHe4kvj5Mgv9MTdS9rL5Dxrg8d2qrTkzI';
        const FOLDER_ID = '1cstVGEu9aSqYnSMNJsbH_-2s1wtn-jsj';

        async function searchFiles() {
            const query = encodeURIComponent(`'${FOLDER_ID}' in parents and trashed=false`);
            let pageToken = null;
            let allFiles = [];
            do {
                const res = await fetch(`https://www.googleapis.com/drive/v3/files?q=${query}&fields=files(id,name,mimeType),nextPageToken&pageSize=1000&pageToken=${pageToken||''}&key=${API_KEY}`);
                const data = await res.json();
                if (data.files) {
                    allFiles.push(...data.files);
                }
                pageToken = data.nextPageToken;
            } while (pageToken);

            const keyword = document.getElementById('searchInput').value.toLowerCase();
            const matchedFiles = [];

            async function getFilesInFolder(folderId) {
                let pageToken = null;
                do {
                    const res = await fetch(`https://www.googleapis.com/drive/v3/files?q='${folderId}'+in+parents+and+trashed=false&fields=files(id,name,mimeType),nextPageToken&pageSize=1000&pageToken=${pageToken||''}&key=${API_KEY}`);
                    const data = await res.json();
                    for (const file of data.files) {
                        if (file.mimeType === 'application/vnd.google-apps.folder') {
                            await getFilesInFolder(file.id);
                        } else {
                            allFiles.push(file);
                        }
                    }
                    pageToken = data.nextPageToken;
                } while (pageToken);
            }

            await getFilesInFolder(FOLDER_ID);
            const resultsTable = document.getElementById('resultsTable');
            resultsTable.innerHTML = '<tr><th>#</th><th>Filename</th><th>Action</th></tr>';
            let counter = 1;
            allFiles.forEach(file => {
                if (file.name.toLowerCase().includes(keyword)) {
                    const row = resultsTable.insertRow();
                    row.insertCell(0).innerText = counter++;
                    row.insertCell(1).innerText = file.name;
                    const linkCell = row.insertCell(2);
                    const link = document.createElement('a');
                    link.href = `https://drive.google.com/uc?id=${file.id}&export=download`;
                    link.innerText = 'Download';
                    linkCell.appendChild(link);
                }
            });
        }

        function clearResults() {
            document.getElementById('searchInput').value = '';
            document.getElementById('resultsTable').innerHTML = '<tr><th>#</th><th>Filename</th><th>Action</th></tr>';
        }
    </script>
</body>
</html>
